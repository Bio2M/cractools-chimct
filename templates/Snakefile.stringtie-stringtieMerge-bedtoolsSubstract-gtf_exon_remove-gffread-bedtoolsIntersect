# Global snakefile
"""
Date: Fabruary 2017
"""

# CONFIG FILES
configfile: "samples.yml"
configfile: "config.yml"

# VARIABLES FROM CONFIGFILE
# fastq parameters
FASTQ_DIR = config['fastq_dir']
SAMPLES = expand(config['samples'])
# bam parameters
BAM_DIR = config['hisat2']['output_dir']

# others
EMAIL = config['email']

# INCLUDES
include: 'snakefiles/hisat2_pe.snakefile'
include: 'snakefiles/stringtie.snakefile'
include: 'snakefiles/stringtie_merge.snakefile'
include: 'snakefiles/bedtools_subtrack.snakefile'
include: 'snakefiles/gtf_exon_remove.snakefile'
include: 'snakefiles/gffread.snakefile'
include: 'snakefiles/bedtools_intersect.snakefile'

rule all:
    input:
        # expand(config['hisat2']['output_dir']+"/{sample}.bam", sample=config['samples']['paired']),
        # expand(config['stringtie']['output_dir'] + "/{sample}.gtf", sample=SAMPLES),
        # config['stringtie']['output_dir'] + "/" + config['stringtie']['output_merge'],
        # config['bedtools']['output_dir'] + "/" + config['bedtools']['output_subtrack'],
        # config['gtf_exon_remove']['output_file'],
        config['gffread']['output_file'],
        config['bedtools']['output_intersect']
        
    log:
        version = config['version_dir'] + "/snakemake.txt",
    shell:
        "echo snakemake versions $(snakemake --version) > {log.version}"

onsuccess:
    print("Workflow finished, no error")
    #shell( 'mail -s "$HOSTNAME: Workflow finished, no error" ' + EMAIL + ' < {log}')

onerror:
    print("An error occured, pas glop!")
    #shell('mail -s "$HOSTNAME: an error occurred on Workflow" ' + EMAIL + ' < {log}')

